<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ask Joule Parser Test</title>
    <style>
      body {
        font-family: monospace;
        padding: 20px;
        background: #1a1a1a;
        color: #e0e0e0;
      }
      .test-result {
        margin: 10px 0;
        padding: 10px;
        border-left: 3px solid #666;
        background: #2a2a2a;
      }
      .command {
        color: #4a9eff;
      }
      .question {
        color: #ffaa4a;
      }
      .error {
        color: #ff4a4a;
      }
      .unrecognized {
        color: #ffaa4a;
      }
      .summary {
        margin-top: 20px;
        padding: 15px;
        background: #2a2a2a;
        border: 2px solid #4a9eff;
      }
      button {
        padding: 10px 20px;
        background: #4a9eff;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
      }
      button:hover {
        background: #5aaeff;
      }
      pre {
        background: #1a1a1a;
        padding: 10px;
        overflow-x: auto;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <h1>Ask Joule Parser Test</h1>
    <button onclick="runTests()">Run 100 Command Tests</button>
    <button onclick="clearResults()">Clear Results</button>
    <div id="results"></div>
    <div id="summary"></div>

    <script type="module">
      // Import the parser - adjust path as needed
      let parseAskJoule;

      async function loadParser() {
        try {
          // Try to import from the actual source
          const module = await import("/src/utils/askJouleParser.js");
          parseAskJoule = module.parseAskJoule || module.default;
          return true;
        } catch (error) {
          console.error("Failed to load parser:", error);
          return false;
        }
      }

      const testCommands = [
        // Temperature commands
        "set temp to 68",
        "set temperature to 72",
        "set to 70",
        "set my temp to 75",
        "set the temperature to 68",
        "change temp to 65",
        "make it warmer",
        "make it cooler",
        "increase temperature by 2",
        "decrease temp by 3",
        "raise temp 5 degrees",
        "lower temperature 4 degrees",
        "set heat to 70",
        "set cool to 75",
        "set ac to 72",

        // Mode commands
        "set to heat mode",
        "switch to cool",
        "turn on auto",
        "set to off",
        "heat mode",
        "cool mode",
        "auto mode",

        // Preset commands
        "sleep mode",
        "away mode",
        "home mode",
        "set to sleep",
        "activate away mode",
        "set to home",

        // Navigation commands
        "show forecast",
        "go to analysis",
        "open settings",
        "navigate to budget",
        "show me the comparison",
        "open balance point",
        "go to analyzer",
        "show methodology",

        // Status/Query commands
        "what's the temperature",
        "current temp",
        "how hot is it",
        "system status",
        "what's my status",
        "show status",
        "is the heat on",
        "is it running",

        // Settings commands
        "set square feet to 2000",
        "set sq ft to 1500",
        "set home size to 1800",
        "set insulation to good",
        "set HSPF to 10",
        "set SEER to 16",
        "set utility cost to 0.15",
        "set electric rate to 0.12",

        // Help/Info commands
        "help",
        "what can you do",
        "show commands",
        "what commands",
        "explain HSPF",
        "what is SEER",
        "tell me about COP",
        "explain short cycling",

        // Savings/Calculations
        "show savings",
        "calculate savings",
        "what can I save",
        "show my savings",
        "calculate heat loss",
        "what's my heat loss",
        "compare systems",
        "heat pump vs gas",

        // Score/Performance
        "what's my Joule Score",
        "show my score",
        "Joule Score",
        "what's my score",

        // What-if scenarios
        "what if HSPF was 12",
        "what if SEER was 18",
        "what if I had 10 HSPF",

        // Diagnostics
        "show diagnostics",
        "check aux heat",
        "check short cycling",
        "temperature stability",

        // Educational
        "what is a setback",
        "explain differential",
        "what is balance point",
        "explain defrost cycle",

        // Edge cases
        "72 degrees",
        "70",
        "heat",
        "cool",
        "auto",
        "set 68",
        "temp 72",
        "make warmer",
        "make cooler",
        "turn up",
        "turn down",
      ];

      window.runTests = async function () {
        const resultsDiv = document.getElementById("results");
        const summaryDiv = document.getElementById("summary");

        resultsDiv.innerHTML = "<p>Loading parser...</p>";

        const parserLoaded = await loadParser();
        if (!parserLoaded) {
          resultsDiv.innerHTML =
            '<p class="error">Failed to load parser. Make sure you\'re running this from the app.</p>';
          return;
        }

        resultsDiv.innerHTML = "<p>Running tests...</p>";

        const results = {
          commands: 0,
          questions: 0,
          errors: 0,
          unrecognized: 0,
          details: [],
        };

        let output = "";

        for (const cmd of testCommands) {
          try {
            const parsed = await parseAskJoule(cmd, {});
            const isCommand = parsed?.isCommand === true || parsed?.action;
            const isQuestion = parsed?.isCommand === false;

            if (isCommand) {
              results.commands++;
              output += `<div class="test-result"><span class="command">‚úÖ COMMAND:</span> ${cmd}<pre>${JSON.stringify(
                parsed,
                null,
                2
              )}</pre></div>`;
            } else if (isQuestion) {
              results.questions++;
              output += `<div class="test-result"><span class="question">‚ùì QUESTION:</span> ${cmd}</div>`;
            } else {
              results.unrecognized++;
              output += `<div class="test-result"><span class="unrecognized">‚ùå UNRECOGNIZED:</span> ${cmd}<pre>${JSON.stringify(
                parsed,
                null,
                2
              )}</pre></div>`;
            }

            results.details.push({
              input: cmd,
              parsed: parsed,
              isCommand: isCommand,
              isQuestion: isQuestion,
            });
          } catch (error) {
            results.errors++;
            output += `<div class="test-result"><span class="error">üí• ERROR:</span> ${cmd} ‚Üí ${error.message}</div>`;
            results.details.push({
              input: cmd,
              error: error.message,
            });
          }
        }

        resultsDiv.innerHTML = output;

        summaryDiv.innerHTML = `
                <div class="summary">
                    <h2>Summary</h2>
                    <p><strong>Commands recognized:</strong> ${
                      results.commands
                    }</p>
                    <p><strong>Questions detected:</strong> ${
                      results.questions
                    }</p>
                    <p><strong>Unrecognized:</strong> ${
                      results.unrecognized
                    }</p>
                    <p><strong>Errors:</strong> ${results.errors}</p>
                    <p><strong>Total tested:</strong> ${testCommands.length}</p>
                    <p><strong>Success rate:</strong> ${(
                      (results.commands / testCommands.length) *
                      100
                    ).toFixed(1)}%</p>
                </div>
            `;

        console.log("Test Results:", results);
      };

      window.clearResults = function () {
        document.getElementById("results").innerHTML = "";
        document.getElementById("summary").innerHTML = "";
      };
    </script>
  </body>
</html>
